Документация по оконным функциям
https://postgrespro.ru/docs/postgrespro/current/tutorial-window
https://postgrespro.ru/docs/postgrespro/current/functions-window
_Оконная функция_ выполняет вычисления для набора строк, некоторым образом связанных с текущей строкой. Её действие можно сравнить с вычислением, производимым агрегатной функцией. Однако с оконными функциями строки не группируются в одну выходную строку, что имеет место с обычными, не оконными, агрегатными функциями. Вместо этого, эти строки остаются отдельными сущностями. Внутри же, оконная функция, как и агрегатная, может обращаться не только к текущей строке результата запроса.

Вот пример, показывающий, как сравнить зарплату каждого сотрудника со средней зарплатой его отдела:

```sql
SELECT depname, empno, salary, avg(salary) OVER (PARTITION BY depname) FROM empsalary;

  depname  | empno | salary |          avg
-----------+-------+--------+-----------------------
 develop   |    11 |   5200 | 5020.0000000000000000
 develop   |     7 |   4200 | 5020.0000000000000000
 develop   |     9 |   4500 | 5020.0000000000000000
 develop   |     8 |   6000 | 5020.0000000000000000
 develop   |    10 |   5200 | 5020.0000000000000000
 personnel |     5 |   3500 | 3700.0000000000000000
 personnel |     2 |   3900 | 3700.0000000000000000
 sales     |     3 |   4800 | 4866.6666666666666667
 sales     |     1 |   5000 | 4866.6666666666666667
 sales     |     4 |   4800 | 4866.6666666666666667
(10 rows)
```

|Функция<br><br>Описание|
|---|
|`row_number` () → `bigint`<br><br>Возвращает номер текущей строки в её разделе, начиная с 1.|
|`rank` () → `bigint`<br><br>Возвращает ранг текущей строки с пропусками; то же, что и `row_number` для первой родственной ей строки.|
|`dense_rank` () → `bigint`<br><br>Возвращает ранг текущей строки без пропусков; по сути эта функция считает группы родственных строк.|
|`percent_rank` () → `double precision`<br><br>Вычисляет относительный ранг текущей строки, то есть (`rank` - 1) / (общее число строк раздела - 1). Таким образом, результат лежит в интервале от 0 до 1, включительно.|
|`cume_dist` () → `double precision`<br><br>Возвращает кумулятивное распределение, то есть (число строк раздела, предшествующих или родственных текущей строке) / (общее число строк раздела). Таким образом, результат лежит в интервале от 1/_`N`_ до 1.|
|`ntile` ( _`num_buckets`_ `integer` ) → `integer`<br><br>Возвращает целое от 1 до значения аргумента для разбиения раздела на части максимально близких размеров.|
|`lag` ( _`value`_ `anycompatible` [, _`offset`_ `integer` [, _`default`_ `anycompatible`]] ) → `anycompatible`<br><br>Возвращает значение _`value`_, вычисленное для строки, сдвинутой на _`offset`_ строк от текущей к началу раздела; если такой строки нет, возвращается значение _`default`_ (оно должно быть совместимого с _`value`_ типа). Оба аргумента, _`offset`_ и _`default`_, вычисляются для текущей строки. Если они не указываются, _`offset`_ считается равным 1, а _`default`_ — `NULL`.|
|`lead` ( _`value`_ `anycompatible` [, _`offset`_ `integer` [, _`default`_ `anycompatible`]] ) → `anycompatible`<br><br>Возвращает значение _`value`_, вычисленное для строки, сдвинутой на _`offset`_ строк от текущей к концу раздела; если такой строки нет, возвращается значение _`default`_ (оно должно быть совместимого с _`value`_ типа). Оба аргумента, _`offset`_ и _`default`_, вычисляются для текущей строки. Если они не указываются, _`offset`_ считается равным 1, а _`default`_ — `NULL`.|
|`first_value` ( _`value`_ `anyelement` ) → `anyelement`<br><br>Возвращает значение (_`value`_), вычисленное для первой строки в рамке окна.|
|`last_value` ( _`value`_ `anyelement` ) → `anyelement`<br><br>Возвращает значение (_`value`_), вычисленное для последней строки в рамке окна.|
|`nth_value` ( _`value`_ `anyelement`, _`n`_ `integer` ) → `anyelement`<br><br>Возвращает значение (_`value`_), вычисленное в _`n`_-ой строке в рамке окна (считая с 1), или `NULL`, если такой строки нет.|

