Взять ФИО сотрудника из файла и найти его в базе Чикаго, в справочнике сотрудников. Если сотрудник найден и количество найденных значений >1, проверить наличие почты (доп. поле 1), если заполнено и количество найденных значений >1, проверить дату увольнения, чтобы была пустой. Если найденных значений все же >1 или сотрудник не найден - создать сотрудника в Чикаго и присвоить ему этот атрибут "СотрудникУИД". Дистрибьютер для нового по умолчанию = ЦО. Если сотрудник найден (1 уникальный) - заполнить атрибут "СотрудникУИД" (что в дополнительных атрибутах).

refPhysicalPersonsNewRows создадим таблицу которая будет иметь в себе строки с последней синхронизации, в ней есть столбцы:
- useStatus - это флаг обозначающий к какой группе принадлежит запись, изначально ее значение 'n', но в момент выполнения процедуры он будет обновляться
- idInRefPhysicalPersons - это id из таблицы refPhysicalPersons

Из этого условия написанного Алексеем образуем многоуровневый поход к созданию пользователей и обновлению.

dismissal: сотрудники у которых есть дата окончания работы в зуп/elma
fakeDismissal: сотрудники по которым существует событие увольнения, но, согласно актуальной выгрузке, они являются действующими сотрудниками.

create уровни:
1. сотрудник найден по ФИО и count()>1
2. сотрудник найден по ФИО, почтой заполнен столбец Post и count()>1
3. сотрудник найден по ФИО, почтой заполнен столбец Post, DateDismissal = '1900-01-01 00:00:00.000' и count()>1

update уровни:
1. сотрудник найден по ФИО и count()=1
2. сотрудник найден по ФИО, почтой заполнен столбец Post и count()=1
3. сотрудник найден по ФИО, почтой заполнен столбец Post, DateDismissal = '1900-01-01 00:00:00.000' и count()=1

createDoesntExist: действующие сотрудники для которых не нашлось совпадения по ФИО

Для всех строк update, create, createDoesntExist выше мы присваиваем значение столбца outercode из 1С и в столбце  refPhysicalPersonsNewRows.useStatus. Строкам в refPhysicalPersonsNewRows присваиваем флаг в useStatus в следующей последовательности

Последовательность разметки по уровням следующая, при этом в каждый уровень выбираем строки у которых refPhysicalPersonsNewRows.useStatus = 'n' (это позволяет исключать записи предыдущих уровней).

Если существует хотя бы одна записи в таблице refPhysicalPersons где outercode not in ('0', '')
	тогда:
		1. fakeDismissal
		2. dismissal
		3. create3
		4. update3
		5. create2
		6. update2
		7. create1
		8. update1
		9. createDoesntExist
	в ином случае:
		1. dismissal
		2. createDoesntExist

Результат работы процедуры будет представлен в таблице refPhysicalPersonsNewRows до запуска следующей операции


