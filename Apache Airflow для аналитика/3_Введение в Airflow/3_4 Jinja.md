предыдущая [[3_4 Контекст]]
следующая [[3_4 Задание на понимание контекста задачи]]


**Jinja - шаблонизатор**

Jinja - это шаблонизатор. То есть мета язык который позволяет встраивать код напрямую в текст. Я предполагаю что вы знакомы с Python. Поэтому проведу аналогию с функцией `eval` которая может воспринимать строковые литералы как код. 

```bash
square_number = eval('4 * 5')
print(square_number)

# Output: 20
```

На практике его используют в первую очередь в веб разработке, так как это очень удобно прописывать шаблоны кода прямо в HTML документы, организую например циклы для формирования блоков и тд... В шаблонах Jinja можно использовать переменные, условные операторы, циклы, фильтры и другие конструкции, чтобы создавать динамический контент на основе переданных данных.

Давайте посмотрим на простой пример того как работает Jinja без применения к Airflow.

**Практика:**

**Вывод строки**

В данном коде просто выведем значение строки, в целом вам не нужно сильно погружаться в данный код чтобы понять что все это значит, основная мысль это то что мы не использую переменные назначаем переменные и передаем в них значения.

```python
import jinja2

# Создадим "окружение"
environment = jinja2.Environment()

# Создадим текстовый шаблон с переменной name
template = environment.from_string("Hello, {{ name }}!")

# Выведем строку и положим в неё дополнительное значение
template.render(name="World")
```

```python
u'Hello World!' # Результат работы
```

**Вывод последовательности**

Данный код стоит уже разобрать отдельно, он генерирует последовательность чисел от 1 до 10. Используя только текст. Без переменных. Синтаксис немного необычный. 

```python
from jinja2 import Template

# Выведем список чисел через в цикле который реализуем через Jinja
t = Template("My favorite numbers: {% for n in range(1,10) %}{{n}} " "{% endfor %}")
t.render()
```

```yaml
My favorite numbers: 1 2 3 4 5 6 7 8 9
```

**Разберем что происходит в данном примере:**

Выражение Jinja использует цикл `for`, чтобы создать последовательность чисел от 1 до 9.

Давайте разберем его по частям:

1. `{% for n in range(1,10) %}`: Это начало цикла `for`. Он указывает Jinja на то, что мы хотим выполнить цикл для переменной `n` в диапазоне от 1 до 9. Таким образом, цикл будет выполняться 9 раз, присваивая переменной `n` значения от 1 до 9.
    
2. `{{n}} " "`: Это выражение Jinja, которое выводит значение переменной `n`. `{{...}}` используется для вставки переменных в шаблон. Здесь `{{n}}` отображает текущее значение переменной `n`.
    
3. `{% endfor %}`: Это завершение цикла `for`. Оно указывает Jinja на конец блока цикла.
    

Данный пример стоит использовать при решении следующей задачи.  

**Jinja в Airflow. Макросы**

В контексте Apache Airflow, Jinja используется для динамической генерации значений и аргументов в определении задач (Task), таких как SQL-запросы, команды командной строки, пути к файлам и другие параметры. Его можно встраивать в код операторов. На предыдущем шаге мы разобрали несколько.

Давайте рассмотрим ещё несколько примеров:

```python
from airflow import DAG 
from datetime import datetime 
from airflow.operators.python_operator import PythonOperator 

default_args = {
   "owner": "airflow", 
   "start_date": datetime(2020, 9, 19)
}
 
dag = DAG(
   dag_id="dag", 
   default_args=default_args, 
   schedule_interval="@daily"
) 

# Функция использующая контекст 
def _print_exec_date(date, **context): 
    print("Дата запуска задачи", date) 
    
task = PythonOperator(
  task_id='task1',
  python_callable=_print_exec_date ,
  op_kwargs={
      'date': '{{ ds }}',
  },
  dag=dag)
```

Вывод данного кода:

![](https://ucarecdn.com/8aa600f4-881f-4ecf-928c-e2bbd6db5bca/)

Данный код используя переменные в PythonOperator обращается к дате запуска задачи. Далее в функции мы выводим значение в логи. Пример [выражений](https://airflow.apache.org/docs/apache-airflow/stable/templates-ref.html) которые можно использовать в операторах.

**Пример в облаке**

Ссылка на DAG: [http://158.160.116.58:8001/tree?dag_id=0_Examples_3.4.3](http://158.160.116.58:8001/tree?dag_id=0_Examples_3.4.3)

Посмотрите логи в задаче.

**Дополнительные ссылки**

- [https://pythonru.com/uroki/7-osnovy-shablonizatora-jinja](https://pythonru.com/uroki/7-osnovy-shablonizatora-jinja)
#### Задача
Напишите функцию, только с Jinja выражением, которая выводит четную последовательность от 1 до N-1. Пробел между цифрами одиночный!
```python
from jinja2 import Template
x = int(input())
t = Template("{% for n in range(2,x,2) %}{{n}} " "{% endfor %}")
print(t.render(x=x))
```
