предыдущая [[3_4  Проектная работа финал. Учтем контекст исполнения задачи.]]
следующая [[Apache Airflow для аналитика/4_Подробнее про Airflow/4_1 Executors и Pools|4_1 Executors и Pools]]


Немного отвлечемся от процесса разработки и изучим как же работает Airflow на более низком уровне. В этом уроке мы изучим какие компоненты входят в системы и как взаимодействуют друг с другом.

#### Основные компоненты

Airflow это модульная система состоящая из 5 основных компонентов.

- Папка с дагами (директория где лежат скрипты описания ваших пайплайнов)
- База метаданных (база данных для хранения информации о запускаемых задачах)
- Web сервер (админка которая доступна через веб интерфейс)
- Scheduler (он же планировщик, выполняет всю основную работу, проверяет и обновляет даги, следит за расписанием)
- Executor (механизм запуска задач)

Взаимодействие этих компонентов друг с другом:

![](https://ucarecdn.com/5be6b215-124e-4d52-99ba-a00793fdf3b8/)

#### Как выглядит процесс запуска DAG

Для начала `Scheduler` рекурсивно сканирует папку с дагами чтобы выяснить когда и кого нужно дернуть, проверяет даги на доступность и обновления. Он прямым образом сканирует файлы которые там лежат и проверяет код на наличие объектов, наличие ошибок. 

![](https://ucarecdn.com/f803d618-88a1-427e-b367-6a2bc852033a/)

Если вдруг будет найдена ошибка то на главной странице появится уведомление об этом. Ошибки связаны только с синтаксисом Airflow, но не кода который написан внутри ваших функций. Пример такой ошибки:

![](https://ucarecdn.com/d06b1620-703c-4434-9336-a8df27922811/)

После того как `Scheduler` решит что DAG пора запустить в работу вступает `Executor` Он отвечает за запуск задач, и в зависимости от бекенда задачи отправляются в [IPC](https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%B6%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D1%81%D1%81%D0%BD%D0%BE%D0%B5_%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D0%B5), иначе говоря очередь.

![](https://ucarecdn.com/12245d1c-c607-4efc-b81d-88cc43c25db6/)

После включается `Worker` он вытаскивает задачу из очереди и начинает исполнение. Для `Sensor` возможна ситуация повторения задачи, которая именуется как _Rescheduler,_ то есть постановка обратно в очередь пока не достигнем нужного события_._ Но мы изучим это позднее.

![](https://ucarecdn.com/fa8432b3-828e-4029-9713-c8191baaee23/)

Далее в зависимости от того какой статус задачи у нас будет, например **Success** то поток выполнения прекращается, в случае **Failed** задача может или упасть или повториться, если данный маркер был проставлен в настройке дага. 

![](https://ucarecdn.com/31870d36-73a0-4c95-bc1a-e7072e75c404/)