ПРОДЛЖИТЬ ОТСЮДА
предыдущая [[5_1 Задание на работу с нотификацией]]
следующая [[5_2 Ветвление в Airflow]]

Сенсоры - это особые операторы, которые проверяют условие в течение определенного времени. Если условие выполняется, задача считается успешной, и выполнение DAG может продолжаться. Если условие не выполняется, то сенсор не падает, а ждет следующей проверки. И так в течении какого заданного промежутка времени, или бесконечно (настраиваемый параметр). 

Все сенсоры имеют несколько параметров (на примере PythonSensor):

```python
partner_b = PythonSensor(
    task_id='task',
    poke_interval=120, # Через какое время перезапускаться
    timeout=10,# Время до принудительного падения
    mode="reschedule", # Режим перезапуска
    python_callable=func, # Вызываемая функция
    soft_fail=True # Пропустить, скипнуть, задачу если она упадет
)
```

**Параметры исполнения**

- **poke:** Это режим по умолчанию. Сенсор проверяет условие в течение всего времени выполнения, это значит что он не засыпает и всегда находится в рабочем состоянии, а значит занимает место в [`pool`](https://stepik.org/lesson/559332/step/4?unit=553413) 
- **poke_interval:** Время между проверками условия в режиме poke.
- **reschedule:** Если условие не выполнено, сенсор "засыпает" и переносит следующую проверку на более позднее время. `[Pool](https://stepik.org/lesson/559332/step/4?unit=553413)` не занят.
- **Timeout:** Максимальное время проверки условия. После этого сенсор упадет в состояние **failed**
- **Soft Fail:** Помечает задачу как пропущенную, если условие не выполнено. То есть не завершится **failed**

**Пример в облаке** 

Ссылка: `[http://158.160.116.58:8001/tree?dag_id=0_Examples_5.2.2.Sensor](http://158.160.116.58:8001/tree?dag_id=0_Examples_5.2.2.Sensor)`

**Когда и как использовать**

- **Установите разумный тайм-аут:** Явно укажите, сколько времени сенсор должен ждать перед завершением. По умолчанию этот период составляет семь дней, что может быть избыточно для большинства случаев.
    
- **Используйте режим изменения расписания:** Если возможно, особенно для долгоживущих сенсоров, выбирайте режим, при котором сенсор освобождает `pool` то есть **reschedule**. Это помогает избежать блокировок в Airflow, когда сенсор постоянно удерживают все доступные ресурсы.
    
- **Подходящий режим poke_interval:** Если интервал между проверками очень короткий (менее 5 минут), рекомендуется использовать режим poke, подходит для задач которым не требуется долгая проверка. Режим **reschedule** в таких случаях может привести к излишней нагрузке.
    
- Сенсоры реализованы таким образом, что логи дописываются в файл, а не пишутся в новый, поэтому вы всегда сможете прочитать полный лог всех запусков вашего сенсора.