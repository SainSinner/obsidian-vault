предыдущая [[4_3 Настройка]]
следующая [[5_1 Плагины]]

Когда вы используете инструмент вроде Airflow, как узнать, что что-то пошло не так? Пользователи Airflow могут проверить пользовательский интерфейс Airflow, чтобы определить состояние DAGs, но это неэффективный способ. Airflow умеет обрабатывать события **failed** или **success** для дагов, и выполнять callback, если произошло одно из них. То есть нотификацию в удобный вам мессенджер или почту. В нашей статье мы будем отправлять уведомление в Telegram.

Для начала вспомним какие состояние бывают в задач и на какие мы можем среагировать:

- on_success_callback: Вызывается при успешном выполнении задачи или DAG.
- on_failure_callback: Вызывается, когда задача или DAG терпит неудачу.
- on_retry_callback: Вызывается при повторной попытке выполнения задачи.

Для примера, такой код будет реагировать на состояние задачи, помните мы про это говорили уже. И вызывать некую функцию которая будет выполняться в этот момент, именно здесь мы и можем отправить **alert**

```python
from datetime import timedelta
from airflow import DAG

default_args = {
    'on_failure_callback': some_function, # Задача упала
    'on_success_callback': some_other_function, # задача успешно отработала
    'on_retry_callback': another_function, # Задача повторяется
}
with DAG(
    'tutorial',
    default_args=default_args,
    schedule_interval=timedelta(days=1),
    start_date=days_ago(2),
) as dag: pass
```

Пример функции которая отправит сообщение в Телеграм чат с именем таска который сработает при успешной работе таска.

```python
def some_other_function(context):
    send_message = TelegramOperator(
        task_id='send_message_telegram',
        telegram_conn_id='telegram_id',
        text=context.get('task_instance').task_id)
    return send_message.execute(context=context)
```

**На следующем шаге, видео того как отработает этот код!**

**Пример в облаке**

Ссылка: [http://158.160.116.58:8001/tree?dag_id=0_Examples_5.1.3](http://158.160.116.58:8001/tree?dag_id=0_Examples_5.1.3) Можете включить и посмотреть реализацию в данном [чате](https://t.me/stepiktelegramtest). Чуть дальше будет настройка в Google Colab где вы сможете сделать тоже самое руками.