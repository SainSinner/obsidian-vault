предыдущая [[5_1 Нотификация]]
следующая [[5_1 Задание на работу с нотификацией]]

Чтобы была возможность использовать данный плагин, необходимо прописать следующее:
1. В docker-compose.yml для airflow прописать следующее:
```    # Пробрасываем папку с дагами
    volumes:
      - ./airflow/dags:/usr/local/airflow/dags
      - ./airflow/plugins:/usr/local/airflow/plugins
```
Это если в папке с проектом docker в Ubuntu у нас будет папка airflow и в ней уже созданы папки dags и plugins. ниже описано чем должна быть наполнена папка plugins.
2. В Dockerfile должны быть следующие записи (насколько я понимаю):
```
# Папка с дагами и плагинами
ENV AIRFLOW__CORE__DAGS_FOLDER=/usr/local/airflow/dags 
ENV AIRFLOW__CORE__PLUGINS_FOLDER=/usr/local/airflow/plugins
```
1. В Dockerfile для airflow-code-editor прописать следующее:
[дока по airflow-code-editor](https://pypi.org/project/airflow-code-editor/)
```
# Настройки airflow-code-editor
# AIRFLOW__CODE_EDITOR__ROOT_DIRECTORY это директория которую будем считать за рутовую
ENV AIRFLOW__CODE_EDITOR__ROOT_DIRECTORY='/usr/local/airflow'
# AIRFLOW__CODE_EDITOR__MOUNT так сможем добавить еще одну папку чтобы отображалась в кодэдиторе
ENV AIRFLOW__CODE_EDITOR__MOUNT='name=plugins,path=/usr/local/airflow/plugins'
```

У Airflow есть удобный способ держать ваш код в едином месте. Это папка с именем `plugins/` которая позволяет размещать свои Операторы, Хуки (узнаем позже) и Сенсоры в удобном виде. Ее расположение настраивается в конфиг файле как и в случае с папкой с дагами. Однако лучше всего рассмотреть это на практике. Внизу будет инструкция для изучения в облаке.

Классическая структура для папки с плагинами.

```markdown
plugins/
├── __init__.py
└── custom_plugin
    └── operators
        └── custom_operators.py
        └── __init__.py
    └── hooks
        └── hook.py
        └── __init__.py
    └── sensors
        └── sensor.py
        └── __init__.py
    └── __init__.py
```

**Пример из облака**

Посмотрите как выглядит структура плагина по данной [ссылке](http://158.160.116.58:8001/code_editor/)  

![[Pasted image 20241002183313.png]]

Внутри `custom_operator.py` лежит следующий код

```python
from airflow.models.baseoperator import BaseOperator

class HelloOperator(BaseOperator):

    def __init__(
            self,
            name: str,
            **kwargs) -> None:
        super().__init__(**kwargs)
        self.name = name

    def execute(self, context):
        message = "Hello {}".format(self.name)
        print(message)
        return message
```

Это так называемый кастомный Оператор, с которым мы познакомимся далее. Мы сами реализовали Оператор который выполняет одну функцию, которая пишет `Hello {...}` в лог файл. Ниже приме кода (DAG) который вызовет данный оператор

```python
from custom_plugin.operators.custom_operators import HelloOperator
from airflow import DAG
from datetime import timedelta, datetime
from airflow.utils.dates import days_ago

# Создадим объект класса DAG
dag = DAG(
    'AirFlow_5_1_import_HelloOperator',
    start_date=datetime(2015, 12, 1),
    schedule_interval='@daily')
hello_task = HelloOperator(task_id='sample-task', name='foo_bar', dag=dag)
```

Важные строчки из этого кода  ( доступ к коду как вы поняли работает через обычный `import` ):

```python
from custom_plugin.operators.custom_operators import HelloOperator
```