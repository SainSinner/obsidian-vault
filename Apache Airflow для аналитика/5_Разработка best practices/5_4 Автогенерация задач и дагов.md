предыдущая [[5_3 Кастомный Operator и Hook]]
следующая [[5_4 Задача на генерацию сенсоров]]

**Автогенерация задач**

Так как создание задач в Airflow это простой Python код, то возможно генерировать задачи "на лету". Пример генерации задач

```python
dag = DAG('dag',schedule_interval=timedelta(days=1), start_date=days_ago(1))
 
task_list=list()
for i in range(0, 10):
    task_list.append(DummyOperator(task_id=f'task_{i}', dag=dag))
    if i:
      task_list[i-1] >> task_list[i]
```

**Вывод:**

![](https://ucarecdn.com/8577cc40-7ecd-428d-8d0d-963526ffb392/)

Ссылка на пример: `[http://158.160.116.58:8001/tree?dag_id=0_Examples_5.4.1.1](http://158.160.116.58:8001/tree?dag_id=0_Examples_5.4.1.1)`

**Автогенерация DAGs** 

По аналогии с предыдущей задачей возможна и генерация дагов.

```python
# Функция создания Дагов
def create_dag(dag_id,
               dag_number,
               default_args,
               schedule='@daily'):

    dag = DAG(dag_id,
              schedule_interval=schedule,
              default_args=default_args)

    with dag:
        t1 = DummyOperator(task_id=f'task', dag=dag)

    return dag


# Код для генерации дагов через range()
for dag_number in range(1, 4):
    dag_id = f'dag_{dag_number}'

    # Настройки по умолчанию
    default_args = {'owner': 'airflow',
                    'start_date': datetime(2021, 1, 1)
                    }
    
    # globals возвращает словарь с глобальной таблицей объектов — словарь текущего модуля.
    globals()[dag_id] = create_dag(dag_id, dag_number, default_args)
```

Данная функция возвращает в качестве результата объект DAG, и мы сохраняем эти значения в глобальном словаре модуля. 

Ссылка на пример: `[http://158.160.116.58:8001/tree?dag_id=0_Examples_5.4.5.2__66](http://158.160.116.58:8001/tree?dag_id=0_Examples_5.4.5.2__66)`

![](https://ucarecdn.com/130370f8-6362-4d6f-bad2-ab01f92c5392/)