предыдущая [[5_4 Автогенерация задач и дагов]]
следующая [[Используя HttpSensor и код ниже обратиться по адресу]]

У вас есть готовый сенсор который с некоторой вероятностью отрабатывает или нет. Ранее мы с вами не касались этого, но по аналогии с методом `execute` (у операторов) у сенсоров есть метод `poke`. Ожидается что он вернет `True или False` и в зависимости от ответа завершится или нет. В данном примере за вас написан кастомный сенсор который возвращает значение с определенной вероятностью.

```haskell
from airflow.sensors.base import BaseSensorOperator
import numpy as np

class CustomSensor(BaseSensorOperator):

    def poke(self, context):
        return_value = np.random.binomial(1, 0.3)
        return bool(return_value)


# Здесь и далее код создание задачи-сенсора

dag = DAG(...)
sensor_1 = CustomSensor(....)
```

Вам необходимо взять код этого сенсора и написать автогенерацию задач сенсеров, задачи должны запускаться параллельно, создать 3 задачи. Параметры для сенсоров задать следующими. Код сенсора не нужно класть в Plugin. Разместите его в файле с вашим DAG.

```json
{
    "poke_interval": 4,
    "timeout": 50,
    "mode": "reschedule",
    "soft_fail": true
}
```

#### Ответ
```python
from airflow.hooks.base import BaseHook
from airflow.models import BaseOperator
from airflow import DAG
from datetime import timedelta
from airflow.utils.dates import days_ago
from airflow.sensors.base import BaseSensorOperator
from datetime import datetime
import numpy as np


class CustomSensor(BaseSensorOperator):

    def poke(self, context):
        return_value = np.random.binomial(1, 0.3)
        return bool(return_value)


dag_default_args = {
    'start_date': datetime(2021, 1, 1)
}
# Здесь и далее код создание задачи-сенсора

# dag = DAG(...)
dag = DAG('AirFlow_5_4_1', schedule='@daily', default_args=dag_default_args)

sensor_default_args = {
    "poke_interval": 4,
    "timeout": 50,
    "mode": "reschedule",
    "soft_fail": True
}
for sensor_number in range(0, 3):
    sensor_id = f'sensor_{sensor_number}'

    globals()[sensor_id] = CustomSensor(dag=dag, task_id=sensor_id, default_args=sensor_default_args)
```