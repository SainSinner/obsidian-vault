предыдущая [[2_2_Ликбез по ETL]]
следующая [[2_2 Почему нам нужен Airflow]]

Теперь давайте настроим для нашего скрипта ежедневный автоматический запуск с помощью утилиты CRON. Если вы никогда не использовали этот инструмент, позвольте мне дать небольшое пояснение: 

**CRON** - это утилита в операционных системах UNIX и подобных им, предназначенная для планирования и автоматизации задач по расписанию. С помощью Cron можно устанавливать определенное время или периодичность выполнения определенных команд или скриптов. Задачи Cron описываются в файле `crontab` это такое специальный файл который принимает определенный синтаксис и время от времени выполняет необходимые команды.

Её синтаксис достаточно прост, сначала идёт время запуска `0 10 * * *`, затем пользователь, например `root` от которого будет запуск, и непосредственно команда `python /scripts/job.py`

```bash
# Запуск питон скрипта
0 10 * * * root python /scripts/job.py
```

#### **Практика:**

Как выглядит команда настройки времени исполнения в CRON:

![](https://ucarecdn.com/62094c43-542d-4c7c-9796-cbc51b5c4f24/)

**Команды**

Запуск каждую минуту 

```markdown
* * * * *
```

 Запуск каждые 2 минуты 

```markdown
*/2 * * * * 
```

Запуск в 10 и 20 минут каждый час

```undefined
10,20 * * * *
```

 Запуск каждый будний день

```undefined
0 0 * * 1-5
```

В 00:00 первого дня, в каждом 4-м месяце

```markdown
0 0 1 */4 *
```

**Полезные ссылки**

- [Отличная статья по основам Cron](https://tproger.ru/translations/guide-to-cron-jobs/)
- [Помощник в генерации Cron выражений](https://crontab.guru/)
- [Настройка шедулера для Windows](https://netpeak.net/ru/blog/kak-nastroit-zapusk-r-skripta-po-raspisaniyu/)


- сохраняем скрипт в формате `.py`, если еще не сделали это раньше
- создаем файл `.bat`. Например через **notepad++**, (сохранить как > batch file)
- в батч файл пишем инструкцию - путь до интерпретатора, пробел, пусть до скрипта. У меня выглядит так: **"C:\Users\sgrekhov\AppData\Local\Programs\Python\Python312\python.exe" "C:\Users\sgrekhov\AppData\Local\Programs\Python\Python312\python.exe"** (кавычки оставляем). На второй строке можно добавить команду **pause**, тогда терминал не закроется, после выполнения задания
- далее ищем на компьютере "планировщик задач". Можно найти через поиск
- выбираем "создать простую задачу"
- идем по пунктам. там все просто. Называем задачу, ставим триггер "ежедневно", выбираем время, "Запустить программу", выбираем наш `.bat` файл через обзор, проверяем, закрываем. Время можно выбрать какой-нить ближайшее, либо запустить ее вручную, найдя в списке активных задач

При запуске задачи скорее всего будет ошибка `sqlite3.operationalerror unable to open database file example.db`. Как я понял, это из-за того, что при работе скрипта, создает файл `.db`, который лежит в папке со скриптом. Планировщик запускается из другого места и не может найти этот файл. 

Указываем в скрипте путь до базы. У меня выглядит так:

`CON = sqlite3.connect("C:/Users/sgrekhov/OneDrive - УрФУ/Coding/GuitHub/AirFlow/example.db")` Двойные слешы нужны для винды

Инфу брал отсюда [https://datatofish.com/python-script-windows-scheduler/](https://datatofish.com/python-script-windows-scheduler/)